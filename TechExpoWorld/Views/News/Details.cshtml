@model NewsArticleWithCommentsViewModel

@{
    ViewBag.Title = Model.NewsArticle.Title;
}

<section>
    <h2>@Model.NewsArticle.Title</h2>
    <article class="d-flex justify-content-between">
        <p class="m-0">
            <span class="text-info">@Model.NewsArticle.AuthorName - </span>
            <span class="text-dark">@Model.NewsArticle.CreatedOn</span>
        </p>
        <p class="m-0">
            <span>Views: @Model.NewsArticle.ViewCount |</span>
            <a href="#comment-section">Comments: @Model.TotalComments</a>
        </p>
    </article>
    <article class="d-flex justify-content-between">
        <p>
            @if (Model.NewsArticle.LastModifiedOn != null)
            {
                <span>Last Edit: @Model.NewsArticle.LastModifiedOn</span>
            }
        </p>
        <p class="text-end">
            Category:
            <a asp-controller="News" asp-action="All" asp-route-category="@Model.NewsArticle.CategoryName" class="fw-bold">
                @Model.NewsArticle.CategoryName
            </a>
        </p>
    </article>
    <article>
        <article class="article-img">
            <img src="@Model.NewsArticle.ImageUrl" alt="@Model.NewsArticle.Title (@Model.NewsArticle.CategoryName)" class="img-fluid w-100" />
        </article>
        <p class="p-3">@Model.NewsArticle.Content</p>
        <span>Tags:</span>
        @foreach (var tag in Model.NewsArticle.TagNames)
        {
            <a asp-controller="News" asp-action="All" asp-route-tag="@tag" class="fst-italic">@tag/</a>
        }
    </article>
</section>

@{
    ViewBag.NewsArticleId = Model.NewsArticleId;
    ViewBag.CommentForm = Model.CommentForm;
    ViewBag.Comments = Model.Comments;
    ViewBag.Depth = 0;
}

<section class="text-center mt-3" id="comment-section">
    <button class="btn btn-primary">Leave a comment below</button>
    <article class="d-none">
        <button class="btn btn-light">Hide</button>
        <partial name="_CommentFormPartial" />
    </article>
</section>

<section class="mt-5" id="replies-section">
    <partial name="_CommentsPartial" />
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        let commentButton = document.querySelector('#comment-section button');
        let commentArea = document.querySelector('#comment-section article');

        let displayCommentForm = (commentButton, commentArea) => {
            commentButton
                .addEventListener('click', (e) => {
                    commentArea.classList.remove('d-none');
                    commentButton.classList.add('d-none');
                });

            commentArea.querySelector('button')
                .addEventListener('click', (e) => {
                    commentArea.classList.add('d-none');
                    commentButton.classList.remove('d-none');
                });
        };

        displayCommentForm(commentButton, commentArea);

        let replies = document.querySelectorAll('#replies-section > article');

        replies.forEach(r => {
            let replyButton = r.querySelector('section button');
            let replyArea = r.querySelector('section article');

            displayCommentForm(replyButton, replyArea);
        });
    </script>
}